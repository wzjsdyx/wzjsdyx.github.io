<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/animal_toy_cute_doll_teddy_72.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/animal_toy_cute_doll_teddy_72.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wzjsdyx.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="show me bug">
<meta property="og:type" content="website">
<meta property="og:title" content="芯青年">
<meta property="og:url" content="https://wzjsdyx.github.io/index.html">
<meta property="og:site_name" content="芯青年">
<meta property="og:description" content="show me bug">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Youngster">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wzjsdyx.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>芯青年</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">芯青年</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/12/secure-debug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/12/secure-debug/" class="post-title-link" itemprop="url">secure debug</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-06-12 10:35:31 / 修改时间：10:36:11" itemprop="dateCreated datePublished" datetime="2024-06-12T10:35:31+08:00">2024-06-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%A6%E8%A7%84MCU/" itemprop="url" rel="index"><span itemprop="name">车规MCU</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/12/secure-debug/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/12/secure-debug/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/12/SOTA-secure-boot%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/12/SOTA-secure-boot%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">SOTA + secure boot方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-06-12 09:53:14 / 修改时间：10:36:39" itemprop="dateCreated datePublished" datetime="2024-06-12T09:53:14+08:00">2024-06-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%A6%E8%A7%84MCU/" itemprop="url" rel="index"><span itemprop="name">车规MCU</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/12/SOTA-secure-boot%E6%96%B9%E6%A1%88/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/12/SOTA-secure-boot%E6%96%B9%E6%A1%88/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>主要有如下几个部分：</p>
<ul>
<li><p>bank0 《&#x3D;&#x3D;》bank0校验参数页</p>
</li>
<li><p>bank1 《&#x3D;&#x3D;》bank1校验参数页</p>
</li>
<li><p>SOTA swap配置页</p>
</li>
</ul>
<p>其中：</p>
<ul>
<li>bank0，bank1会做硬件swap；</li>
<li>bank0校验参数页，bank1校验参数页没做硬件swap，由romcode根据SOTA swap配置去读取相应的校验参数页</li>
</ul>
<img src="/2024/06/12/SOTA-secure-boot%E6%96%B9%E6%A1%88/image-20240612102802897.png" class="">


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/12/secure-boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/12/secure-boot/" class="post-title-link" itemprop="url">secure boot</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-06-12 09:52:42 / 修改时间：10:18:37" itemprop="dateCreated datePublished" datetime="2024-06-12T09:52:42+08:00">2024-06-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%A6%E8%A7%84MCU/" itemprop="url" rel="index"><span itemprop="name">车规MCU</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/12/secure-boot/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/12/secure-boot/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>车规芯片中，有secure boot的选项，即对Flash中的user code进行校验，防止非法修改</p>
</blockquote>
<p>大致的工作流程如下:</p>
<p>1、host romcode执行，此时的romcode会读取（dflash info&#x2F;OTP区域）<code>secure boot配置</code>（hsm enable，secure boot enable等）；</p>
<p>2、如果secure boot enable，则读取（pflash info区域）<code>secure boot的校验参数</code>（verify size，boot address， HSM public key addr，HSM code signature addr等）与HSM交互，然后对Flash的特定区域进行校验；</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/12/flash-SOTA%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/12/flash-SOTA%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">flash SOTA设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-06-12 09:11:03 / 修改时间：10:25:30" itemprop="dateCreated datePublished" datetime="2024-06-12T09:11:03+08:00">2024-06-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%A6%E8%A7%84MCU/" itemprop="url" rel="index"><span itemprop="name">车规MCU</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/12/flash-SOTA%E8%AE%BE%E8%AE%A1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/12/flash-SOTA%E8%AE%BE%E8%AE%A1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>flash的SOTA设计是一种在线升级方案，这里简述下其工作机制。</p>
<p>SOTA即软件在线升级（Software updates Over The Air），是指在不连接烧写器的情况下，通过CAN、UART或其它通讯方式，实现应用程序的更新。</p>
</blockquote>
<h1 id="SOTA实现机制"><a href="#SOTA实现机制" class="headerlink" title="SOTA实现机制"></a>SOTA实现机制</h1><h2 id="常规实现方法"><a href="#常规实现方法" class="headerlink" title="常规实现方法"></a>常规实现方法</h2><p>在进行SOTA时，需要把旧的应用程序擦除，把新的应用程序写入。</p>
<p>常规的实现方式需要分别开发BootLoader程序和APP程序，MCU上电先运行BootLoader，BootLoader根据情况选择是否跳转到APP和是否进行程序更新。</p>
<p>具体来说有以下几种方式：</p>
<ul>
<li><p>方案一：更新程序时，由APP接收更新数据并暂存于Flash，再更改APP更新标志位；MCU重启时，BootLoader检查更新标志位，如有效，则擦除旧的APP，再将暂存于Flash的新APP数据写入APP运行地址处。<br>该方案的优点是更新数据的接收由APP完成，BootLoader不需要通讯协议栈，代码量更小，且数据传输中断时，原有APP不损坏。<br>缺点是需要额外的Flash空间暂存更新数据。</p>
</li>
<li><p>方案二：BootLoader中内置通讯协议栈，更新时，先向MCU发送指令使其跳转到BootLoader，之后先擦除旧APP，在接收新APP的同时直接将其写入Flash的APP运行地址处。<br>该方案的优点是不需要额外的Flash暂存数据。<br>缺点是BootLoader代码更复杂，且如果数据传输发生中断，旧的APP将不能被恢复。该方案更适合Flash容量较小的MCU。</p>
</li>
<li><p>方案三：将方案一和方案二相结合，即在BootLoader程序中内置通讯协议栈，更新时，先向MCU发送指令使其跳转到BootLoader，之后接收更新数据的时候，采用方案一的方法，先将数据暂存于Flash，待数据全部接收完成后再擦除旧的APP，写入新的APP。<br>该方案结合了方案一和方案二的优点，且能在没有APP或APP损坏的状态下实现程序更新。<br>缺点是BootLoader代码量更大，Flash空间占用更大。</p>
</li>
<li><p>方案四：在Flash中划分出两块相同大小的区域，分为A区和B区，都用来存放APP，但同一时间下只有一个区的APP是有效的，分别设置一个标志位标识其有效性。初始状态下先将APP写入A区，更新的时候，将新的APP写入B区，再把A区的APP擦除，同时更新两个区的有效性标志位状态。BootLoader中判断哪个区的APP有效，就跳转到哪个区运行。<br>这种方法优点不需要重复拷贝APP数据，但最大的一个缺点是AB区的APP程序运行地址不同，需要分别编译，从而使得可应用性大大降低。</p>
</li>
</ul>
<p>经过上面的分析，可以看出来每种方案都有其优缺点，对于Flash容量较小的MCU，通常采用方案二，因为没有过多的空间暂存APP更新数据。但对于MCU的Flash容量很大的，通常要先把APP暂存下来再进行更新，防止数据传输中断导致APP不可用。上面的方案一、三、四都能实现，但并不完美。</p>
<p><font color=blue>如果实现的SOTA机制更类似于方案四，且Flash支持两种地址映射方式，从而使得APP编译时不需要区分AB区，使用相同的地址即可，从而避免了方案四的硬伤，就可以提供一种最佳的SOTA方案，下面描述的就是此种实现方法</font></p>
<h2 id="项目实现方法"><a href="#项目实现方法" class="headerlink" title="项目实现方法"></a>项目实现方法</h2><p>程序上不用对地址做改动，硬件做地址映射</p>
<img src="/2024/06/12/flash-SOTA%E8%AE%BE%E8%AE%A1/image-20240612095815405.png" class="">

<p>在升级的时候（假设当前程序运行在bank0，<code>bank0处于0x0020_000,bank1处于0x0040_0000</code>）：</p>
<p>1、先擦除bank1的内容</p>
<p>2、更新新的APP到bank1</p>
<p>3、更新SOTA swap参数</p>
<p>4、复位，对SOTA swap参数解析，rom code跳转到bank1（<code>bank1处于0x0020_0000,bank0处于0x0040_0000</code>）执行</p>
<hr>
<p>参考博客：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014157109/article/details/121006232">SOTA机制详解</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/11/3-AMBA-AHB-APB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/11/3-AMBA-AHB-APB/" class="post-title-link" itemprop="url">3 AMBA/AHB/APB</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-06-11 21:26:50" itemprop="dateCreated datePublished" datetime="2024-06-11T21:26:50+08:00">2024-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-06-12 08:35:29" itemprop="dateModified" datetime="2024-06-12T08:35:29+08:00">2024-06-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SoC%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">SoC设计</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/11/3-AMBA-AHB-APB/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/11/3-AMBA-AHB-APB/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="AHB概述"><a href="#AHB概述" class="headerlink" title="AHB概述"></a>AHB概述</h1><h2 id="AHB版本"><a href="#AHB版本" class="headerlink" title="AHB版本"></a>AHB版本</h2><h2 id="AHB信号"><a href="#AHB信号" class="headerlink" title="AHB信号"></a>AHB信号</h2><h2 id="AHB基本操作"><a href="#AHB基本操作" class="headerlink" title="AHB基本操作"></a>AHB基本操作</h2><p>在单Master和多Slave的简单设计中，AHB总线系统可以按照下图设计：</p>
<img src="/2024/06/11/3-AMBA-AHB-APB/image-20240611215804055.png" class="">

<p><font color=red>data phase mux control?什么意思？怎么实现？</font></p>
<p>如果遵循<code>AMBA 5 AHB</code>规范，可以按照如下方式连接：</p>
<ul>
<li>多个<code>AHB Master</code>共享一个bus，需要使用<code>Master Multiplexer</code>和<code>Master arbiter</code></li>
<li>多个<code>AHB Slave</code>返回的data和response信号需要使用<code>Slave Multiplexer</code> feedback to <code>AHB Master</code></li>
</ul>
<hr>
<p>信号可以被划分为<code>address phase </code>信号和<code>data phase </code>信号：</p>
<p><code>address phase</code> signals include:</p>
<ul>
<li>HADDR, HTRANS, HSEL, HWRITE, HSIZE.</li>
<li>Optional: HPROT, HBURST, HMASTLOCK, HEXCL, HAUSER</li>
</ul>
<p><code>data phase</code> signals include:</p>
<ul>
<li><p>HWDATA, HRDATA, HRESP, HREADY (and HREADYOUT).</p>
</li>
<li><p>Optional: HEXOKAY, HWUSER, HRUSER.</p>
</li>
</ul>
<p><font color=blue>每一个transfer都是有address phase和data phase</font></p>
<p><font color=blue>transfer是pipelined，意味着当前transfer的address phase可以和上一次transfer的data phase overlap</font></p>
<img src="/2024/06/11/3-AMBA-AHB-APB/image-20240611221656976.png" class="">

<hr>
<p><font color=blue>每个phase的都是由<code>当前activated AHB Slave data phase的hreadyout assert</code>而结束;</font></p>
<p><font color=red>这一块不是很明白他的描述，还需要再理解一下</font></p>
<p>来自<code>AHB Slave的HREADYOUT信号</code>经过<code>Slave Multiplexer</code>，形成了<code>system-wide HREADY</code>信号；</p>
<p>此Slave Multiplexer在transfer的数据阶段工作，其控制信号可以通过AHB decoder&#x2F;HSEL以及HREADY信号生成；</p>
<img src="/2024/06/11/3-AMBA-AHB-APB/image-20240611223909464.png" class="">

<p><font color=red>这一块电路对应的时序是什么样子？</font></p>
<p>如果某一个AHB Slave当前没有被select，其HREADYOUT应该是h</p>
<p>igh，表明其状态是ready的。</p>
<p>该从机仅仅只能在上一次transfer完成的时候（由system-wide的HREADY high表示），再进行新的transfer</p>
<img src="/2024/06/11/3-AMBA-AHB-APB/image-20240611230046424.png" class="">



<p><font color=red>没太懂这两段想要表达什么意思？需要结合具体的代码实现看</font></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/11/python%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/11/python%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">python基础语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-06-11 15:01:33 / 修改时间：15:05:30" itemprop="dateCreated datePublished" datetime="2024-06-11T15:01:33+08:00">2024-06-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%84%9A%E6%9C%AC/" itemprop="url" rel="index"><span itemprop="name">脚本</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%84%9A%E6%9C%AC/python%E8%84%9A%E6%9C%AC/" itemprop="url" rel="index"><span itemprop="name">python脚本</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/11/python%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/11/python%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="条件分支"><a href="#条件分支" class="headerlink" title="条件分支"></a>条件分支</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition1:</span><br><span class="line">    <span class="comment"># statement1</span></span><br><span class="line"><span class="keyword">elif</span> condition2:</span><br><span class="line">    <span class="comment"># statement2</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment">#statement3</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/07/verilog%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/07/verilog%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91/" class="post-title-link" itemprop="url">verilog条件编译</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-06-07 11:38:37" itemprop="dateCreated datePublished" datetime="2024-06-07T11:38:37+08:00">2024-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-06-11 15:04:51" itemprop="dateModified" datetime="2024-06-11T15:04:51+08:00">2024-06-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/verilog%E8%AF%AD%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">verilog语法</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/07/verilog%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/07/verilog%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/07/%E8%BD%A6%E8%A7%84MCU-bootrom-%E9%AA%8C%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/07/%E8%BD%A6%E8%A7%84MCU-bootrom-%E9%AA%8C%E8%AF%81/" class="post-title-link" itemprop="url">车规MCU bootrom 验证</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-06-07 10:36:27" itemprop="dateCreated datePublished" datetime="2024-06-07T10:36:27+08:00">2024-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-06-11 14:41:04" itemprop="dateModified" datetime="2024-06-11T14:41:04+08:00">2024-06-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%A6%E8%A7%84MCU/" itemprop="url" rel="index"><span itemprop="name">车规MCU</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/07/%E8%BD%A6%E8%A7%84MCU-bootrom-%E9%AA%8C%E8%AF%81/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/07/%E8%BD%A6%E8%A7%84MCU-bootrom-%E9%AA%8C%E8%AF%81/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>车规MCU需要HSM信息安全，其实现方式有可能会利用到host bootrom</p>
<p>一个不懂的东西，怎么去快速了解上手？</p>
<p>1、需要自己看看已有的资料有一定的认知；</p>
<p>2、私下问下同事，询问不懂的问题；</p>
<p>2、开会和其他同事同步，进一步加深理解；</p>
<p>3、总结思考实践–&gt;有自己的认知；</p>
</blockquote>
<h1 id="host-bootrom功能描述"><a href="#host-bootrom功能描述" class="headerlink" title="host bootrom功能描述"></a>host bootrom功能描述</h1><p>主要提供normal boot和secure boot的功能</p>
<p>BootRom需要使用GPIO，Uart，HSM message box等模块。</p>
<h1 id="测试流程"><a href="#测试流程" class="headerlink" title="测试流程"></a>测试流程</h1><p>&#x3D;&#x3D;》load config只是从flash info区域读取数据，不care OTP区域；</p>
<p><font color=blue>hsm enable以及secure boot是通过读取寄存器</font>？也不用care OTP区域；</p>
<p><font color=red>读取寄存器？读取什么寄存器？</font></p>
<p>&#x3D;&#x3D;》init debug表明是否需要打印log（optional，默认disable）</p>
<p>要打印log就初始化UART串口；不需要打印log就不初始化UART串口；</p>
<p>&#x3D;&#x3D;》rom code的执行是否需要切换成系统时钟（optional，默认enable）</p>
<p>切换成PLL提供的系统时钟，处理速度就比较快，加速启动时间</p>
<p>启动PLL也就是初始化PLL大概需要100us的时间</p>
<p><font color=red>系统时钟：从什么时钟切换到PLL时钟？？？</font></p>
<h2 id="non-security-boot"><a href="#non-security-boot" class="headerlink" title="non-security boot"></a>non-security boot</h2><p>&#x3D;&#x3D;》两个secure boot check？</p>
<p>security boot分成两部分：一个是启动校验，一个是等待校验结果</p>
<p>所以流程图上有两个security boot check框</p>
<p>&#x3D;&#x3D;》Restore debug and clock(Optional)</p>
<p>关闭UART以及将系统时钟切回去</p>
<p>&#x3D;&#x3D;》jump to user code</p>
<p>跳转到pflash的user code（default是0x20_0000）</p>
<ul>
<li><p>user code可以配置从pflash的info区域执行；</p>
</li>
<li><p>user code可以配置从pflash的main区域执行；</p>
</li>
</ul>
<p>执行user code</p>
<h2 id="security-boot"><a href="#security-boot" class="headerlink" title="security boot"></a>security boot</h2><p>&#x3D;&#x3D;》 security boot需要很多的配置信息，首先需要确认配置信息是否正确（主要是对地址以及size的有效性进行检查）</p>
<p>&#x3D;&#x3D;》等待HSM ready</p>
<p>&#x3D;&#x3D;》执行check code（<font color=blue>校验用户代码的代码</font>），通过发命令到HSM，（主要是校验地址，校验size以及校验算法），让其开始校验<font color=blue>用户代码</font></p>
<p>&#x3D;&#x3D;》等待check结果（done，pass&#x2F;fail）</p>
<p>正确就继续执行下面的流程，即走启动用户代码的流程；</p>
<p>错误就执行while 1 （default的行为），也可配置成system reset，通过watch dog进行复位；</p>
<p>吴奎那边有现成的工具可以做对应的测试；</p>
<h1 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><p>&#x3D;&#x3D;》什么时候出现check error</p>
<p>将需要校验的代码，手动修改成错误数据</p>
<blockquote>
<p>校验算法是通过OTP配置好的</p>
<p>校验的地址和size都是在info区域配置的</p>
</blockquote>
<p>&#x3D;&#x3D;》standby boot</p>
<p>pflash user code进入standby模式之后，默认还会执行security boot校验（optional可配置）</p>
<p>&#x3D;&#x3D;》用户代码和被校验的代码</p>
<p>安全启动的时候就是被校验的代码</p>
<p>没有安全启动的时候就是未被校验的代码，即用户代码</p>
<p>&#x3D;&#x3D;》默认是不swap的</p>
<p>swap之后，如下图这些配置起始地址就会从0x01004800–&gt;0x01005000，offset不变</p>
<img src="/2024/06/07/%E8%BD%A6%E8%A7%84MCU-bootrom-%E9%AA%8C%E8%AF%81/image-20240611113255222.png" class="">



<p>&#x3D;&#x3D;》security boot的参数比较多</p>
<p>hsm security boot的各个参数是绑定到一起的，通常来说错一个都会导致HSM check error</p>
<p>&#x3D;&#x3D;》SOTA功能测试</p>
<p>有两个配置区域，一个是正确的配置，一个是错误的配置；</p>
<p>通过配置SOTA enable还是disable可以进行不同的测试；</p>
<p>&#x3D;&#x3D;》HSM安全启动测试</p>
<p>不同的校验算法都校验成功；</p>
<p>根据hsm的算法，去校验什么东西，然后做对应的配置；</p>
<p>询问HSM的人，怎么把算法用起来；</p>
<p>例如：key需要配置什么东西，验签signature需要设置什么东西和算法相关，使用什么算法，就需要根据对应的算法做相应的配置</p>
<h2 id="pflash-info-HSM-security-boot各项配置参数的含义"><a href="#pflash-info-HSM-security-boot各项配置参数的含义" class="headerlink" title="pflash info:HSM security boot各项配置参数的含义"></a>pflash info:HSM security boot各项配置参数的含义</h2><h2 id="dflash-info-OTP各项配置参数的含义"><a href="#dflash-info-OTP各项配置参数的含义" class="headerlink" title="dflash info:OTP各项配置参数的含义"></a>dflash info:OTP各项配置参数的含义</h2><h2 id="SOTA机制"><a href="#SOTA机制" class="headerlink" title="SOTA机制"></a>SOTA机制</h2><h2 id="boot-flow-数据流"><a href="#boot-flow-数据流" class="headerlink" title="boot flow&#x2F;数据流"></a>boot flow&#x2F;数据流</h2><p>例如，host core先动起来，执行host romcode代码，然后加载pflash info区域的值；</p>
<p>然后判断是否为security boot，如果是的话，发送command，去调动hsm做校验；</p>
<p><font color=red>hsm根据OTP的value去使用相应的算法做校验？？？具体的流程是什么样？</font></p>
<h2 id="测试item"><a href="#测试item" class="headerlink" title="测试item"></a>测试item</h2><p>配置选项&#x2F;输入条件</p>
<p>check point？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/07/apb-sync-unit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/07/apb-sync-unit/" class="post-title-link" itemprop="url">apb_sync_unit</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-06-07 09:27:24" itemprop="dateCreated datePublished" datetime="2024-06-07T09:27:24+08:00">2024-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-06-11 15:05:05" itemprop="dateModified" datetime="2024-06-11T15:05:05+08:00">2024-06-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IC%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1tips/" itemprop="url" rel="index"><span itemprop="name">IC电路设计tips</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/07/apb-sync-unit/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/07/apb-sync-unit/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>项目中可能需要对APB协议进行CDC的设计，简单的方法是通过使用ready信号反压来实现；</p>
</blockquote>
<h1 id="RTL代码实现"><a href="#RTL代码实现" class="headerlink" title="RTL代码实现"></a>RTL代码实现</h1><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> apb_sync_unit(</span><br><span class="line">  <span class="keyword">input</span>  psel       ,</span><br><span class="line">  <span class="keyword">input</span>  pwrite     ,</span><br><span class="line">  <span class="keyword">input</span>  pclk       ,</span><br><span class="line">  <span class="keyword">input</span>  fclk       ,</span><br><span class="line">  <span class="keyword">input</span>  prst_b     ,</span><br><span class="line">  <span class="keyword">input</span>  frst_b     ,</span><br><span class="line">  <span class="keyword">output</span> psel_sync  ,</span><br><span class="line">  <span class="keyword">output</span> pready     </span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">//apb valid from pclk</span></span><br><span class="line"><span class="keyword">reg</span> psel_d;</span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> pclk <span class="keyword">or</span> <span class="keyword">negedge</span> prst_b)</span><br><span class="line">  <span class="keyword">if</span>(!prst_b)</span><br><span class="line">    psel_d &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    psel_d &lt;= psel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">wire</span> psel_pos = (!psel_d) &amp; psel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> ptrans;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> pclk <span class="keyword">or</span> <span class="keyword">negedge</span> prst_b)</span><br><span class="line">  <span class="keyword">if</span>(!prst_b)</span><br><span class="line">    ptrans &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (psel_pos)</span><br><span class="line">    ptrans &lt;= ~ptrans;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ptrans sync to fclk domain</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] ptrans_sync;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> fclk <span class="keyword">or</span> <span class="keyword">negedge</span> frst_b)</span><br><span class="line">  <span class="keyword">if</span>(!frst_b)</span><br><span class="line">    ptrans_sync &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    ptrans_sync &lt;=&#123;ptrans_sync[<span class="number">1</span>:<span class="number">0</span>],ptrans&#125;;</span><br><span class="line"><span class="keyword">assign</span> psel_sync = ptrans_sync[<span class="number">2</span>] ^ ptrans_sync[<span class="number">1</span>];<span class="comment">//both trigger</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ptrans sync back to pclk</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] ptrans_sync_pclk;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> pclk <span class="keyword">or</span> <span class="keyword">negedge</span> prst_b)</span><br><span class="line">  <span class="keyword">if</span>(!prst_b)</span><br><span class="line">    ptrans_sync_pclk &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    ptrans_sync_pclk &lt;=&#123;ptrans_sync_pclk[<span class="number">1</span>:<span class="number">0</span>],ptrans_sync[<span class="number">2</span>]&#125;;</span><br><span class="line"><span class="keyword">wire</span> pready_comb  = ptrans_sync_pclk[<span class="number">2</span>] ^ ptrans_sync_pclk[<span class="number">1</span>];<span class="comment">//bothedge trigger</span></span><br><span class="line"><span class="keyword">assign</span> pready = psel ? pready_comb : <span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h1 id="电路解析"><a href="#电路解析" class="headerlink" title="电路解析"></a>电路解析</h1><img src="/2024/06/07/apb-sync-unit/image-20240607093602194.png" class="">



<h1 id="使用限制"><a href="#使用限制" class="headerlink" title="使用限制"></a>使用限制</h1><blockquote>
<p>apb_sync_unit只使用了psel信号，  通过检测其上升沿从而进行同步，使用时需要保证连续的apb transaction之间，psel信号不会一直为高；</p>
<p>（之前的项目中，外设APB接口协议实现的可能不标准，没有penable，因此sync电路只用了psel进行实现）；</p>
</blockquote>
<p>&#x3D;&#x3D;》如果连续多比apb transaction过程中psel一直为高，会导致pready信号一直拉低，如下图所示是一个先写后读的时序：</p>
<p>错误分析：第一笔写操作，能够回pready；</p>
<p>​             	  第二笔读操作，sync电路检测由于psel&#x3D;1’b1是连续的，检测不到pos，因此当前读操作得不到处理，会导致pready一直拉低</p>
<img src="/2024/06/07/apb-sync-unit/image-20240607093744708.png" class="">



<p><font color=blue>为了处理 连续的apb transaction，psel一直为高  可以参考如下几种做法</font></p>
<h2 id="改进方式1"><a href="#改进方式1" class="headerlink" title="改进方式1"></a>改进方式1</h2><blockquote>
<p>APB接口有penable信号，不改动apb_sync_unit</p>
</blockquote>
<img src="/2024/06/07/apb-sync-unit/image-20240607094323521.png" class="">

<img src="/2024/06/07/apb-sync-unit/image-20240607094352996.png" class="">





<h2 id="改进方式2"><a href="#改进方式2" class="headerlink" title="改进方式2"></a>改进方式2</h2><blockquote>
<p>APB接口有penable信号，  改动apb_sync_unit</p>
</blockquote>
<img src="/2024/06/07/apb-sync-unit/image-20240607094437852.png" class="">

<img src="/2024/06/07/apb-sync-unit/image-20240607094442804.png" class="">



<h2 id="改进方式3"><a href="#改进方式3" class="headerlink" title="改进方式3"></a>改进方式3</h2><blockquote>
<p>APB接口没有penable信号， 改动apb_sync_unit</p>
</blockquote>
<img src="/2024/06/07/apb-sync-unit/image-20240607094502525.png" class="">

<img src="/2024/06/07/apb-sync-unit/image-20240607094506574.png" class="">



<h1 id="时序约束"><a href="#时序约束" class="headerlink" title="时序约束"></a>时序约束</h1><blockquote>
<p>APB同步：根据同步之后的psel信号，去抓address phase的控制信号。</p>
<p>如果时钟频率很快，T&#x3D;2ns，假设psel经过2拍同步，那么会经过4ns的时间，从clock domain1 到clock domain 2,；</p>
<p>假设psel sync之后，其他的控制信号例如pwrite，padd等，还没有到达clock domain2（绕线之后，可能有多达到10ns的delay）。那么就会出现错误状态！！！</p>
<p>可能出现在高制程，频率很快的设计中；例如BUS内部的信号可能走线会很远，导致这种情况的发生！</p>
</blockquote>
<img src="/2024/06/07/apb-sync-unit/image-20240607095127922.png" class="">


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wzjsdyx.github.io/2024/06/05/MCU%E5%85%B3%E7%94%B5%E4%B8%8A%E7%94%B5%E6%B5%81%E7%A8%8B%E5%8F%8A%E5%85%B6%E6%97%B6%E5%BA%8F%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/animal_toy_cute_doll_teddy_256.png">
      <meta itemprop="name" content="Youngster">
      <meta itemprop="description" content="show me bug">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芯青年">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/05/MCU%E5%85%B3%E7%94%B5%E4%B8%8A%E7%94%B5%E6%B5%81%E7%A8%8B%E5%8F%8A%E5%85%B6%E6%97%B6%E5%BA%8F%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">MCU关电上电流程及其时序分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-06-05 12:17:32 / 修改时间：17:27:23" itemprop="dateCreated datePublished" datetime="2024-06-05T12:17:32+08:00">2024-06-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BD%8E%E5%8A%9F%E8%80%97%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">低功耗设计</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2024/06/05/MCU%E5%85%B3%E7%94%B5%E4%B8%8A%E7%94%B5%E6%B5%81%E7%A8%8B%E5%8F%8A%E5%85%B6%E6%97%B6%E5%BA%8F%E5%88%86%E6%9E%90/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/05/MCU%E5%85%B3%E7%94%B5%E4%B8%8A%E7%94%B5%E6%B5%81%E7%A8%8B%E5%8F%8A%E5%85%B6%E6%97%B6%E5%BA%8F%E5%88%86%E6%9E%90/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="关电和上电顺序"><a href="#关电和上电顺序" class="headerlink" title="关电和上电顺序"></a>关电和上电顺序</h1><p>关电的顺序：<br>1、关闭时钟–》PWR_CLKEN<br>2、拉住reset<br>3、打开ISO–》PWR_ISOON<br>4、关闭Power–》PWR_ON<br>上电的顺序：<br>反过来</p>
<hr>
<p>1、PMU&#x2F;SPM模块enable WIC</p>
<p>2、core执行WFI进入deepsleep mode，此时会自动gating core clock</p>
<p>3、spm wait cache idle（7843 特殊flow）</p>
<p>4、spm走休眠，发出sleep request，wait ACK（就是cache idle以及外设sleep ACK）</p>
<p>5、关闭时钟–》PWR_CLKEN（spm CORE_CLK_EN）</p>
<p>6、<font color=red>拉住reset–》STDBY_PWR_RSTON</font></p>
<p>7、打开ISO–》PWR_ISOON<br>8、关闭Power–》PWR_ON</p>
<p>sleepdeep_gatclk ？ 1’b1 :  (~cm4_sleepdeep) ;</p>
<hr>
<p>正确的case(保存波形，_s1)</p>
<p>复现spm问题(保存波形，_s2)1’吧</p>
<p>修改代码</p>
<p>重新运行</p>
<blockquote>
<p>问题：进不去standby mode，spm 发出sleep request ，等待ACK超时，进入standby失败，CPU自动退出低功耗模式；</p>
</blockquote>
<p><img src="D:\blog\wzjsdyx.github.io\source_posts\2024-06-05-MCU关电上电流程及其时序分析\image-20240605172723153.png" alt="image-20240605172723153"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Youngster"
      src="/images/animal_toy_cute_doll_teddy_256.png">
  <p class="site-author-name" itemprop="name">Youngster</p>
  <div class="site-description" itemprop="description">show me bug</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">123</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Youngster</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '3qPpN2UkBU7Q1vhWnH1WdrQZ-gzGzoHsz',
      appKey     : 'LAapaVzfFkIj1knpaWSWCNDo',
      placeholder: "Looking forward to communication.",
      avatar     : 'monsterid',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
